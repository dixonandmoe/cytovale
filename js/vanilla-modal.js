!function(a,b){if("function"==typeof define&&define.amd)define("VanillaModal",["module","exports"],b);else if("undefined"!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.VanillaModal=c.exports}}(this,function(a,b){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.$$={modal:".modal",modalInner:".modal-inner",modalContent:".modal-content",open:'[rel="modal:open"]',close:'[rel="modal:close"]',page:"body",class:"modal-visible",loadClass:"vanilla-modal",clickOutside:!0,closeKeys:[27],transitions:!0,transitionEnd:null,onBeforeOpen:null,onBeforeClose:null,onOpen:null,onClose:null},this._applyUserSettings(b),this.error=!1,this.isOpen=!1,this.current=null,this.open=this._open.bind(this),this.close=this._close.bind(this),this.$$.transitionEnd=this._transitionEndVendorSniff(),this.$=this._setupDomNodes(),this.error?console.error("Please fix errors before proceeding."):(this._addLoadedCssClass(),this._events().add())}return e(a,[{key:"_applyUserSettings",value:function(b){if("object"===("undefined"==typeof b?"undefined":c(b)))for(var d in b)b.hasOwnProperty(d)&&(this.$$[d]=b[d])}},{key:"_transitionEndVendorSniff",value:function(){if(this.$$.transitions!==!1){var b=document.createElement("div"),c={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var d in c)if(c.hasOwnProperty(d)&&void 0!==b.style[d])return c[d]}}},{key:"_getNode",value:function(b,c){var d=c||document,e=d.querySelector(b);return e?e:(this.error=!0,console.error(b+" not found in document."))}},{key:"_setupDomNodes",value:function(){var b={};return b.modal=this._getNode(this.$$.modal),b.page=this._getNode(this.$$.page),b.modalInner=this._getNode(this.$$.modalInner,this.modal),b.modalContent=this._getNode(this.$$.modalContent,this.modal),b}},{key:"_addLoadedCssClass",value:function(){this._addClass(this.$.page,this.$$.loadClass)}},{key:"_addClass",value:function(b,c){if(b instanceof HTMLElement!=!1){var d=b.className.split(" ");d.indexOf(c)===-1&&d.push(c),b.className=d.join(" ")}}},{key:"_removeClass",value:function(b,c){if(b instanceof HTMLElement!=!1){var d=b.className.split(" ");d.indexOf(c)>-1&&d.splice(d.indexOf(c),1),b.className=d.join(" ")}}},{key:"_setOpenId",value:function(){var b=this.current.id||"anonymous";this.$.page.setAttribute("data-current-modal",b)}},{key:"_removeOpenId",value:function(){this.$.page.removeAttribute("data-current-modal")}},{key:"_getElementContext",value:function(b){return b&&"string"==typeof b.hash?document.querySelector(b.hash):"string"==typeof b?document.querySelector(b):console.error("No selector supplied to open()")}},{key:"_open",value:function(b,c){return this._releaseNode(),this.current=this._getElementContext(b),this.current instanceof HTMLElement==!1?console.error("VanillaModal target must exist on page."):("function"==typeof this.$$.onBeforeOpen&&this.$$.onBeforeOpen.call(this,c),this._captureNode(),this._addClass(this.$.page,this.$$.class),this._setOpenId(),this.isOpen=!0,void("function"==typeof this.$$.onOpen&&this.$$.onOpen.call(this,c)))}},{key:"_detectTransition",value:function(){var b=window.getComputedStyle(this.$.modal,null),c=["transitionDuration","oTransitionDuration","MozTransitionDuration","webkitTransitionDuration"],d=c.filter(function(a){if("string"==typeof b[a]&&parseFloat(b[a])>0)return!0});return!!d.length}},{key:"_close",value:function(b){if(this.isOpen===!0){this.isOpen=!1,"function"==typeof this.$$.onBeforeClose&&this.$$.onBeforeClose.call(this,b),this._removeClass(this.$.page,this.$$.class);var c=this._detectTransition();this.$$.transitions&&this.$$.transitionEnd&&c?this._closeModalWithTransition(b):this._closeModal(b)}}},{key:"_closeModal",value:function(b){this._removeOpenId(this.$.page),this._releaseNode(),this.isOpen=!1,this.current=null,"function"==typeof this.$$.onClose&&this.$$.onClose.call(this,b)}},{key:"_closeModalWithTransition",value:function(b){var c=function(){this.$.modal.removeEventListener(this.$$.transitionEnd,c),this._closeModal(b)}.bind(this);this.$.modal.addEventListener(this.$$.transitionEnd,c)}},{key:"_captureNode",value:function(){if(this.current)for(;this.current.childNodes.length>0;)this.$.modalContent.appendChild(this.current.childNodes[0])}},{key:"_releaseNode",value:function(){if(this.current)for(;this.$.modalContent.childNodes.length>0;)this.current.appendChild(this.$.modalContent.childNodes[0])}},{key:"_closeKeyHandler",value:function(b){"[object Array]"===Object.prototype.toString.call(this.$$.closeKeys)&&0!==this.$$.closeKeys.length&&this.$$.closeKeys.indexOf(b.which)>-1&&this.isOpen===!0&&(b.preventDefault(),this.close(b))}},{key:"_outsideClickHandler",value:function(b){if(this.$$.clickOutside===!0){for(var c=b.target;c&&c!=document.body;){if(c===this.$.modalInner)return;c=c.parentNode}this.close(b)}}},{key:"_matches",value:function(b,c){for(var d=b.target,e=(d.document||d.ownerDocument).querySelectorAll(c),f=0;f<e.length;f++)for(var g=d;g&&g!==document.body;){if(g===e[f])return g;g=g.parentNode}return null}},{key:"_delegateOpen",value:function(b){var c=this._matches(b,this.$$.open);if(c)return b.preventDefault(),b.delegateTarget=c,this.open(c,b)}},{key:"_delegateClose",value:function(b){if(this._matches(b,this.$$.close))return b.preventDefault(),this.close(b)}},{key:"_events",value:function(){var b=this._closeKeyHandler.bind(this),c=this._outsideClickHandler.bind(this),d=this._delegateOpen.bind(this),e=this._delegateClose.bind(this),f=function(){this.$.modal.addEventListener("click",c,!1),document.addEventListener("keydown",b,!1),document.addEventListener("click",d,!1),document.addEventListener("click",e,!1)};return this.destroy=function(){this.close(),this.$.modal.removeEventListener("click",c),document.removeEventListener("keydown",b),document.removeEventListener("click",d),document.removeEventListener("click",e)},{add:f.bind(this)}}}]),a}();b.default=f,a.exports=b.default});